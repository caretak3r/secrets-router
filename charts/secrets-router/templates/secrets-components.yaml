{{- /* 
Conditionally create the Kubernetes secret store component.
Enabled by default but can be disabled via values.yaml
*/ -}}
{{- if .Values.secretStores.kubernetes.enabled }}
apiVersion: dapr.io/v1alpha1
kind: Component
metadata:
  name: kubernetes
  namespace: {{ .Release.Namespace }}
  labels:
    {{- include "secrets-router.labels" . | nindent 4 }}
    app.kubernetes.io/component: secret-store
spec:
  type: secretstores.kubernetes
  version: v1
  metadata:
  - name: defaultNamespace
    value: {{ .Release.Namespace | quote }}
{{- end }}

{{- /* 
Conditionally create the AWS Secrets Manager component.
*/ -}}
{{- if .Values.secretStores.aws.enabled }}
---
apiVersion: dapr.io/v1alpha1
kind: Component
metadata:
  name: aws-secrets-manager
  namespace: {{ .Release.Namespace }}
  labels:
    {{- include "secrets-router.labels" . | nindent 4 }}
    app.kubernetes.io/component: secret-store
spec:
  type: secretstores.aws.secretsmanager
  version: v1
  metadata:
  - name: region
    value: {{ .Values.secretStores.aws.region | default "us-east-1" | quote }}
  {{- if .Values.secretStores.aws.multipleKeyValuesPerSecret }}
  - name: multipleKeyValuesPerSecret
    value: {{ .Values.secretStores.aws.multipleKeyValuesPerSecret | quote }}
  {{- end }}
{{- end }}
